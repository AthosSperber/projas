{% extends 'base.html' %}

{% block content %}
<div class="text-center mb-4">
  <!-- Título e descrição -->
  <h2 class="fw-semibold text-primary">Relatórios</h2>
  <p class="text-muted">
    Clique em <b>"Rodar Web Scraping e Análise"</b> para raspar a página e gerar o relatório automaticamente.
  </p>

  <!-- Botões de ação -->
  <div class="d-flex justify-content-center gap-2 report-actions flex-wrap">
    <!-- Botão que dispara o scraping e análise -->
    <button id="btn-run" class="btn btn-primary">
      🔍 Rodar Web Scraping e Análise
    </button>

    <!-- Link para baixar o relatório PDF gerado -->
    <a class="btn btn-outline-secondary" href="{{ url_for('download_report') }}">
      ⬇️ Baixar PDF
    </a>
  </div>

  <!-- Loader de processamento -->
  <div id="loading" class="mt-3" style="display:none;">
    <div class="spinner-border text-primary" role="status"></div>
    <div>Processando... aguarde</div>
  </div>
</div>

<!-- ==================== SEÇÃO DE RESULTADOS ==================== -->
<div id="results" style="display:none;">
  <div class="row">
    <!-- ======= GRÁFICO ======= -->
    <div class="col-md-6 mb-3">
      <div class="card p-3 shadow-sm">
        <h5 class="text-center mb-3">📊 Distribuição de Sentimentos</h5>
        <canvas id="chart" height="240"></canvas>
      </div>
    </div>

    <!-- ======= RESUMO E ENVIO POR E-MAIL ======= -->
    <div class="col-md-6 mb-3">
      <div class="card p-3 shadow-sm">
        <h5 class="fw-semibold">Resumo da Análise</h5>
        <!-- Lista preenchida dinamicamente via JS -->
        <ul id="summaryList" class="list-unstyled mb-3"></ul>

        <!-- Campo para enviar o relatório por e-mail -->
        <div>
          <label class="form-label">📧 Receber por e-mail</label>
          <div class="input-group">
            <input id="emailInput" class="form-control" type="email" placeholder="seu@exemplo.com">
            <button id="sendEmailBtn" class="btn btn-outline-primary">Enviar</button>
          </div>
          <!-- Mensagem de status (sucesso/erro do envio) -->
          <small id="emailStatus" class="form-text text-muted"></small>
        </div>
      </div>
    </div>
  </div>
</div>

<hr/>

<!-- ==================== TABELA DETALHADA ==================== -->
<div class="table-responsive mt-3">
  <table class="table table-striped table-hover align-middle" id="table-details">
    <thead class="table-light">
      <tr>
        <th>Comentário</th>
        <th>Sentimento</th>
        <th>Confiança</th>
      </tr>
    </thead>
    <tbody>
      <!-- Linhas preenchidas dinamicamente via JS -->
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/report.js') }}"></script>
{% endblock %}
